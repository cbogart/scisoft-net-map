{% extends "base.jinja2" %}
{% block title %}Software details{% endblock %}
{% block content_title  %}Overview{% endblock %}

{% block head %}
  {{ super() }}
  <link href="{{request.static_url('snmweb:static/css/lib/nv.d3.css')}}" rel="stylesheet">
  <style>
    #chart svg {
      height: 400px;
    }
  </style>
{% endblock %}

{% block js %}
  {{ super() }}
  <script src="{{request.static_url('snmweb:static/js/lib/d3.min.js')}}"></script>
  <script src="{{request.static_url('snmweb:static/js/lib/nv.d3.min.js')}}"></script>
  <script>

    function addRow(date, value) {
      $("#graph-data tbody").append(
          $('<tr>')
            .append($('<td>').text(date))
            .append($('<td>').text(value))
      )
    }

    function data() {
      var appData = [];
 
      $.ajaxSetup({
        async: false
      });

      $.getJSON("http://localhost:6543/api/stat/usage_over_time?group_by=day", function(data) {
            var dates = data["data"]["dates"];
            var runs = data["data"]["runs"]; 
            var x, y;
            for (i = 0; i < dates.length; i++) {
                parseDate = d3.time.format("%Y-%m-%d").parse;
                x = parseDate(dates[i]);
                y = runs[i];
                appData.push({'x': x, 'y': y});
                addRow(dates[i],y);
            }
          });
    
      return [
        {
          values: appData,
          key: "Application",
          color: "#ff7f0e"
        }
      ];
    }

    nv.addGraph(function() {
      var chart = nv.models.lineChart()
      .useInteractiveGuideline(true)
      ;
    
      chart.xAxis
      .axisLabel("Date")
      .tickFormat(function(d) {
          return d3.time.format("%x")(new Date(d));
          });

      chart.yAxis
      .axisLabel("Runs")
      .tickFormat(d3.format(".0f"))
      ;
    
      d3.select("#chart svg")
      .datum(data())
      .transition().duration(500)
      .call(chart)
      ;
    
      nv.utils.windowResize(chart.update);
    
      return chart;
    });

  </script>

{% endblock %}


{% block content %}

  <div class="col-md-12">
    <div class="row">
      <div class="col-md-7">
        <h1>Euler <small>version 2.5</small></h1>
      </div>
      <div class="col-md-5" id="app-search">
        <div>
          <button type="button" class="btn disabled btn-success pull-right"> Added to
            comparison
            <span class="glyphicon glyphicon-ok"></span></button>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-3">
        <div class="panel panel-default">
          <div class="panel-heading">
            <img src="{{request.static_url('snmweb:static/img/euler.png')}}" />
          </div>
          <div class="panel-body">
            <a href="{{request.route_url('application')}}" class="btn btn-default btn-block">App profile</a>
            <button type="button" class="btn disabled btn-default btn-block">Version history</button>
            <button type="button" class="btn disabled btn-default btn-block">Used with</button>
            <button type="button" class="btn btn-primary btn-block">Usage over time</button>
            <button type="button" class="btn disabled btn-default btn-block">Operating systems</button>
            <button type="button" class="btn disabled btn-default btn-block">Users over time</button>
          </div>
        </div>
      </div>

      <div class="col-md-9">
        <div class="panel panel-default">
          <div class="panel-body">
            <div id="chart">
              <svg></svg>
            </div>
            <div class="row" id="filters">
              <div class="btn-group">
                <button type="button" class="btn disabled">Period:</button>
                <button type="button" class="btn disabled btn-default">Day</button>
                <button type="button" class="btn disabled btn-default">Week</button>
                <button type="button" class="btn active btn-default">Month</button>
              </div>
              <div class="btn-group">
                <button type="button" class="btn disabled">Time range:</button>
                <button type="button" class="btn disabled btn-default">From: October 2013</button>
                <button type="button" class="btn disabled btn-default">To: April 2014</button>
              </div>
              <div class="btn-group">
                <button type="button" class="btn disabled">Smoothness:</button>
                <button type="button" class="btn active btn-default">None</button>
                <button type="button" class="btn disabled btn-default">3</button>
                <button type="button" class="btn disabled btn-default">5</button>
                <button type="button" class="btn disabled btn-default">7</button>
              </div>
            </div>

          </div>
        </div>
        <table class="table" id="graph-data">
        <thead>
          <tr>
            <th>Date</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
      </div>
    </div>
  </div>
  
{% endblock %}
